<camelContext xmlns="http://camel.apache.org/schema/blueprint" id="67c740bc349ced00070004a9" useMDCLogging="true" streamCache="true">
    <jmxAgent id="agent" loadStatisticsEnabled="true"/>
    <streamCaching id="streamCacheConfig" spoolThreshold="0" spoolDirectory="tmp/camelcontext-#camelId#" spoolUsedHeapMemoryThreshold="70"/>
    <threadPoolProfile id="wiretapProfile" defaultProfile="false" poolSize="0" maxPoolSize="5" maxQueueSize="2000" rejectedPolicy="DiscardOldest" keepAliveTime="10"/>
    <threadPoolProfile id="defaultProfile" defaultProfile="true" poolSize="0" maxPoolSize="10" maxQueueSize="1000" rejectedPolicy="CallerRuns" keepAliveTime="30"/>
    <onException>      <exception>java.lang.Exception</exception>
        <redeliveryPolicy maximumRedeliveries="0" redeliveryDelay="5000"/>
        <setExchangePattern pattern="InOnly"/>
    </onException>
    <onException>
        <exception>java.net.SocketException</exception>
        <redeliveryPolicy maximumRedeliveries="3" redeliveryDelay="3000"/>
    </onException>
    <interceptFrom>
        <to uri="bean:dovetailTracer?method=traceEvent"/>
    </interceptFrom>
    <route id="0df9d084-4783-492b-a9d4-488f2ee298a5">
        <from uri="timer://67c740bc349ced00070004a9_timer?fixedRate=true&amp;period=10000&amp;repeatCount=1"/>
        <to uri="direct:67c740bc349ced00070004a9_test_0df9d084-4783-492b-a9d4-488f2ee298a5"/>
    </route>
    <route id="9aa3aff8-e37c-4059-b9fd-4321454fd9ab">
        <from uri="direct:67c740bc349ced00070004a9_test_0df9d084-4783-492b-a9d4-488f2ee298a5"/>
        <setBody>
            <simple>&lt;persons&gt;
                &lt;person&gt;
                &lt;name&gt;John Doe&lt;/name&gt;
                &lt;/person&gt;
                &lt;person&gt;
                &lt;name&gt;Jane Doe&lt;/name&gt;
                &lt;/person&gt;
                &lt;/persons&gt;</simple>
        </setBody>
        <to uri="direct:67c740bc349ced00070004a9_test_9aa3aff8-e37c-4059-b9fd-4321454fd9ab"/>
    </route>
    <route id="5258ee10-4e8d-4b15-a86f-de6bcc16263b_http_retry">
        <onException>
            <exception>java.net.SocketTimeoutException</exception>
            <log message="Timeout exception: java.net.SocketTimeoutException | Flow: 67c740bc349ced00070004a9 | API Endpoint: https://dovetail.free.beeceptor.com" logName="org.assimbly.errorhandler.67c740bc349ced00070004a9" loggingLevel="WARN"/>
        </onException>
        <onException>
            <exception>org.apache.hc.client5.http.ConnectTimeoutException</exception>
            <log message="Timeout exception: org.apache.hc.client5.http.ConnectTimeoutException | Flow: 67c740bc349ced00070004a9 | API Endpoint: https://dovetail.free.beeceptor.com" logName="org.assimbly.errorhandler.67c740bc349ced00070004a9" loggingLevel="WARN"/>
        </onException>
        <from uri="activemq:67c740bc349ced00070004a9_test_5258ee10-4e8d-4b15-a86f-de6bcc16263b_http_retry?asyncConsumer=true"/>
        <removeHeaders pattern="scheduledJobId" excludePattern="breadcrumbId"/>
        <choice>
            <when>
                <simple>${header.DOVETAIL_RetryAttempts} == null</simple>
                <setProperty name="DOVETAIL_originalHttpMessageMethod">
                    <constant>SET</constant>
                </setProperty>
                <process ref="SetOriginalMessageProcessor"/>
            </when>
        </choice>
        <setHeader name="CamelHttpMethod">
            <constant>GET</constant>
        </setHeader>
        <setHeader name="user-agent">
            <constant>Dovetail/4.17.4</constant>
        </setHeader>
        <setProperty name="useCustomDateHeader">
            <constant>false</constant>
        </setProperty>
        <to uri="https://dovetail.free.beeceptor.com/?transferException=true&amp;cookieStore=#flowCookieStore&amp;headerFilterStrategy=#CustomHttpHeaderFilterStrategy&amp;throwExceptionOnFailure=false&amp;maxTotalConnections=50&amp;connectionsPerRoute=10&amp;connectTimeout=180000&amp;soTimeout=180000&amp;lazyStartProducer=true&amp;followRedirects=true"/>
        <removeHeaders pattern="CamelHttpMethod" excludePattern="breadcrumbId"/>
        <removeHeaders pattern="user-agent" excludePattern="breadcrumbId"/>
        <choice>
            <when>
                <simple>${header.DOVETAIL_RetryAttempts} == 5</simple>
                <choice>
                    <when>
                        <simple>false == "false"</simple>
                        <setHeader name="DOVETAIL_RetryError">
                            <constant>Maximum attempts reached</constant>
                        </setHeader>
                        <log message="HTTP Retry: Maximum attempts reached | Flow: 67c740bc349ced00070004a9 | API Endpoint: https://dovetail.free.beeceptor.com | Retry in 1000 milliseconds | Attempt ${header.DOVETAIL_RetryAttempts} | Body: ${body} | ResponseText: ${header.CamelHttpResponseText}" logName="org.assimbly.errorhandler.67c740bc349ced00070004a9" loggingLevel="WARN"/>
                        <to uri="direct:67c740bc349ced00070004a9_test_5258ee10-4e8d-4b15-a86f-de6bcc16263b"/>

                    </when>
                    <otherwise>
                        <throwException message="HTTP Retry: Maximum attempts reached | Flow: 67c740bc349ced00070004a9 | API Endpoint: https://dovetail.free.beeceptor.com | Retry in 1000 milliseconds | Attempt ${header.DOVETAIL_RetryAttempts} | Body: ${body} | ResponseText: ${header.CamelHttpResponseText}" exceptionType="java.lang.Exception"/>
                    </otherwise>
                </choice>
            </when>
            <when>
                <simple>${header.CamelHttpResponseCode} &gt;= 500</simple>
                <log message="HTTP Status: ${header.CamelHttpResponseCode} ${header.CamelHttpResponseText} | Flow: 67c740bc349ced00070004a9 | API Endpoint: https://dovetail.free.beeceptor.com | Retry in 1000 milliseconds | Attempt ${header.DOVETAIL_RetryAttempts} | Body: ${body} | ResponseText: ${header.CamelHttpResponseText}" logName="org.assimbly.errorhandler.67c740bc349ced00070004a9" loggingLevel="WARN"/>
                <setProperty name="DOVETAIL_originalHttpMessageMethod">
                    <constant>GET</constant>
                </setProperty>
                <process ref="SetOriginalMessageProcessor"/>
                <setHeader name="AMQ_SCHEDULED_DELAY">
                    <constant>1000</constant>
                </setHeader>
                <removeHeaders pattern="CamelHttp*" excludePattern="breadcrumbId"/>
                <to uri="activemq:67c740bc349ced00070004a9_test_5258ee10-4e8d-4b15-a86f-de6bcc16263b_http_retry?timeToLive=86400000&amp;requestTimeout=86400000"/>
            </when>
            <otherwise>
                <setProperty name="DOVETAIL_originalHttpMessageMethod">
                    <constant>DEL</constant>
                </setProperty>
                <process ref="SetOriginalMessageProcessor"/>
                <to uri="direct:67c740bc349ced00070004a9_test_5258ee10-4e8d-4b15-a86f-de6bcc16263b"/>

            </otherwise>
        </choice>
    </route>
    <route id="5258ee10-4e8d-4b15-a86f-de6bcc16263b">
        <onException>
            <exception>java.net.SocketTimeoutException</exception>
            <log message="Timeout exception: java.net.SocketTimeoutException | Flow: 67c740bc349ced00070004a9 | API Endpoint: https://dovetail.free.beeceptor.com" logName="org.assimbly.errorhandler.67c740bc349ced00070004a9" loggingLevel="WARN"/>
        </onException>
        <onException>
            <exception>org.apache.hc.client5.http.ConnectTimeoutException</exception>
            <log message="Timeout exception: org.apache.hc.client5.http.ConnectTimeoutException | Flow: 67c740bc349ced00070004a9 | API Endpoint: https://dovetail.free.beeceptor.com" logName="org.assimbly.errorhandler.67c740bc349ced00070004a9" loggingLevel="WARN"/>
        </onException>
        <from uri="direct:67c740bc349ced00070004a9_test_9aa3aff8-e37c-4059-b9fd-4321454fd9ab"/>
        <choice>
            <when>
                <simple>${header.DOVETAIL_RetryAttempts} == null</simple>
                <setProperty name="DOVETAIL_originalHttpMessageMethod">
                    <constant>SET</constant>
                </setProperty>
                <process ref="SetOriginalMessageProcessor"/>
            </when>
        </choice>
        <setHeader name="CamelHttpMethod">
            <constant>GET</constant>
        </setHeader>
        <setHeader name="user-agent">
            <constant>Dovetail/4.17.4</constant>
        </setHeader>
        <setProperty name="useCustomDateHeader">
            <constant>false</constant>
        </setProperty>
        <to uri="https://dovetail.free.beeceptor.com/?transferException=true&amp;cookieStore=#flowCookieStore&amp;headerFilterStrategy=#CustomHttpHeaderFilterStrategy&amp;throwExceptionOnFailure=false&amp;maxTotalConnections=50&amp;connectionsPerRoute=10&amp;connectTimeout=180000&amp;soTimeout=180000&amp;lazyStartProducer=true&amp;followRedirects=true"/>
        <removeHeaders pattern="CamelHttpMethod" excludePattern="breadcrumbId"/>
        <removeHeaders pattern="user-agent" excludePattern="breadcrumbId"/>
        <choice>
            <when>
                <simple>${header.DOVETAIL_RetryAttempts} == 5</simple>
                <choice>
                    <when>
                        <simple>false == "false"</simple>
                        <setHeader name="DOVETAIL_RetryError">
                            <constant>Maximum attempts reached</constant>
                        </setHeader>
                        <log message="HTTP Retry: Maximum attempts reached | Flow: 67c740bc349ced00070004a9 | API Endpoint: https://dovetail.free.beeceptor.com | Retry in 1000 milliseconds | Attempt ${header.DOVETAIL_RetryAttempts} | Body: ${body} | ResponseText: ${header.CamelHttpResponseText}" logName="org.assimbly.errorhandler.67c740bc349ced00070004a9" loggingLevel="WARN"/>
                        <to uri="direct:67c740bc349ced00070004a9_test_5258ee10-4e8d-4b15-a86f-de6bcc16263b"/>

                    </when>
                    <otherwise>
                        <throwException message="HTTP Retry: Maximum attempts reached | Flow: 67c740bc349ced00070004a9 | API Endpoint: https://dovetail.free.beeceptor.com | Retry in 1000 milliseconds | Attempt ${header.DOVETAIL_RetryAttempts} | Body: ${body} | ResponseText: ${header.CamelHttpResponseText}" exceptionType="java.lang.Exception"/>
                    </otherwise>
                </choice>
            </when>
            <when>
                <simple>${header.CamelHttpResponseCode} &gt;= 500</simple>
                <log message="HTTP Status: ${header.CamelHttpResponseCode} ${header.CamelHttpResponseText} | Flow: 67c740bc349ced00070004a9 | API Endpoint: https://dovetail.free.beeceptor.com | Retry in 1000 milliseconds | Attempt ${header.DOVETAIL_RetryAttempts} | Body: ${body} | ResponseText: ${header.CamelHttpResponseText}" logName="org.assimbly.errorhandler.67c740bc349ced00070004a9" loggingLevel="WARN"/>
                <setProperty name="DOVETAIL_originalHttpMessageMethod">
                    <constant>GET</constant>
                </setProperty>
                <process ref="SetOriginalMessageProcessor"/>
                <setHeader name="AMQ_SCHEDULED_DELAY">
                    <constant>1000</constant>
                </setHeader>
                <removeHeaders pattern="CamelHttp*" excludePattern="breadcrumbId"/>
                <to uri="activemq:67c740bc349ced00070004a9_test_5258ee10-4e8d-4b15-a86f-de6bcc16263b_http_retry?timeToLive=86400000&amp;requestTimeout=86400000"/>
            </when>
            <otherwise>
                <setProperty name="DOVETAIL_originalHttpMessageMethod">
                    <constant>DEL</constant>
                </setProperty>
                <process ref="SetOriginalMessageProcessor"/>
                <to uri="direct:67c740bc349ced00070004a9_test_5258ee10-4e8d-4b15-a86f-de6bcc16263b"/>

            </otherwise>
        </choice>
    </route>
    <route id="88db8598-2e3b-43cd-b012-5be0e9c63be7">
        <from uri="direct:67c740bc349ced00070004a9_test_5258ee10-4e8d-4b15-a86f-de6bcc16263b"/>
        <to uri="log:nl.kabisa.flux//?skipBodyLineSeparator=false&amp;multiline=true&amp;showHeaders=true&amp;showBody=true&amp;showBodyType=true&amp;showFiles=true&amp;showException=false&amp;showStackTrace=false&amp;showCaughtException=false"/>
    </route>
    <property key="frontend.engine" value="dovetail"/></camelContext>