apiVersion: camel.apache.org/v1
kind: Kamelet
metadata:
  name: imaps-source
  labels:
    camel.apache.org/kamelet.type: "source"
spec:
  definition:
    title: "imaps source"
    description: |-
      IMAPS (Internet Message Access Protocol over SSL) â€” to retrieve emails stored on a mail server.
    type: object
    properties:
      scheme:
          title: scheme
          description: scheme
          type: string
      path:
        title: path
        description: path
        type: string
      authenticationType:
        title: authenticationType
        description: The authenticationType to access the mail box.
        type: string
        default: basic
      username:
        title: Username
        description: The username to access the mail box.
        type: string
        x-descriptors:
          - urn:camel:group:credentials
      password:
        title: Password
        description: The password to access the mail box.
        type: string
        format: password
        x-descriptors:
          - urn:camel:group:credentials
      accessToken:
        title: accessToken
        description: The accessToken to access the mail box.
        type: string
        format: string
        x-descriptors:
          - urn:camel:group:credentials
      fetchSize:
        title: Fetch Size
        description: The number of messages fetched for each poll (-1 for no limits).
        type: integer
        default: 10
      delay:
        title: Delay
        description: The delay between fetches in milliseconds.
        type: integer
        default: 60000
      unseen:
        title: unseen
        description: Whether to limit by unseen mails only.
        type: boolean
        default: true
      searchSubject:
        title: searchSubject
        description: The subject to search for.
        type: string
      searchBody:
        title: searchBody
        description: The mail body to search for.
        type: string
      searchFrom:
        title: searchFrom
        description: The from to search for.
        type: string
      searchTo:
        title: to
        description: The to to search for.
        type: string
  dependencies:
    - "camel:kamelet"
  template:
    route:
      from:
        uri: "imaps:{{path}}?authenticationType=RAW({{authenticationType}})&username=RAW({{username}})&password=RAW({{?password}})&accessToken=RAW({{?accessToken}})&fetchSize={{fetchSize}}&delay={{delay}}&searchTerm.subject={{?searchSubject}}&searchTerm.body={{?searchBody}}?searchTerm.from={{?searchFrom}}&searchTerm.to={{?searchTo}}&unseen={{unseen}}&bridgeErrorHandler=true"
        steps:
          - convertBodyTo:
              type: "java.lang.String"
          - to:
              uri: "kamelet:sink"